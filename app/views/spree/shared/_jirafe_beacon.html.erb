<script type="text/javascript">
  /* Jirafe */
  (function(){
      var d=document,g=d.createElement('script'),s=d.getElementsByTagName('script')[0];
          g.type='text/javascript';g.defer=g.async=true;g.src=d.location.protocol+'//beacon.jirafe.com/jirafe_api.js';
          s.parentNode.insertBefore(g,s);
  })();

  var jirafe_site_id = <%= Spree::Jirafe::Config.site_id || '' %>;
  var jirafe_org_id = "";

  function jirafe_deferred(jirafe_api) {

      var data = {};
      var type = "other";

      <% if spree_current_user %>
        data.customer = {
            "id": "<%= spree_current_user.id %>",
            "firstname": "",
            "lastname": "",
            "email": "<%= spree_current_user.email %>"
        };
      <% end %>

      <% if controller_name == "orders" && flash[:notice] == Spree.t(:order_processed_successfully) %>

          var type="order_success";
          jirafe_api.order.success(jirafe_org_id, jirafe_site_id, {
              "order": {
                  "num":  "<%= @order.number %>"
              }
          });

      <% else %>
          var type="other";
      <% end %>

      jirafe_api.pageview(jirafe_org_id, jirafe_site_id, type, data);
  }
</script>
